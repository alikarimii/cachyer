# Cachyer - Type-Safe Caching Layer for TypeScript/Node.js

> AI-friendly reference for integrating Cachyer into projects

## What is Cachyer?

A type-safe caching abstraction layer supporting Redis and Memory adapters with:
- Fluent schema builder for type-safe cache entities
- Key pattern management with parameterized templates  
- Built-in rate limiting and distributed locking
- Pipeline/transaction support for batch operations
- Zero-config defaults with full customization options

## Installation

```bash
npm install cachyer ioredis
```

## Essential Imports

```typescript
// Most common imports
import { 
  createRedisCachyer,      // Production: Redis-backed cache
  createMemoryCachyer,     // Testing: In-memory cache
  createTypedSchema,       // Custom schema definitions
  createHashSchema,        // Pre-built hash template
  createSortedSetSchema,   // Pre-built sorted set template
  createCounterSchema,     // Pre-built counter template
  createKeyBuilder,        // Single parameterized key
  createKeyPatterns,       // Organized key namespace
  createRateLimitService,  // Rate limiting
  createLockService,       // Distributed locks
  pipelineEntry,           // For batch operations
  TTL,                     // Time constants
} from "cachyer";
```

## Quick Patterns

### 1. Basic Cache Setup
```typescript
const cache = createRedisCachyer({
  keyPrefix: "myapp",
  defaultTtl: 3600,
  connectionOptions: { host: "localhost", port: 6379 },
});
```

### 2. Simple Get/Set
```typescript
await cache.set("user:1", JSON.stringify(userData));
const data = await cache.get("user:1");
```

### 3. Hash (Object Storage)
```typescript
await cache.hset("user:1", "name", "John");
await cache.hset("user:1", "email", "john@example.com");
const user = await cache.hgetall("user:1"); // { name: "John", email: "john@example.com" }
```

### 4. Sorted Set (Leaderboards/Feeds)
```typescript
await cache.zadd("leaderboard", [
  { score: 100, member: "player1" },
  { score: 250, member: "player2" },
]);
const top10 = await cache.zrevrange("leaderboard", 0, 9, { withScores: true });
```

### 5. Type-Safe Schema
```typescript
const userSchema = createHashSchema<{ userId: string }>(
  "user",
  "user:{userId}",
  TTL.ONE_HOUR
);

// Type-checked params
await cache.execute(userSchema.operations.hashGetAll, { userId: "123" });
```

### 6. Key Patterns
```typescript
const keys = createKeyPatterns({
  user: {
    profile: { pattern: "user:{userId}:profile" },
    session: { pattern: "session:{sessionId}" },
  },
}, { prefix: "app" });

const key = keys.user.profile({ userId: "123" }); // "app:user:123:profile"
```

### 7. Rate Limiting
```typescript
const limiter = createRateLimitService(cache.adapter, {
  defaultConfig: { maxRequests: 100, windowSeconds: 60 },
});

const result = await limiter.check("user123", "api:posts");
if (!result.allowed) {
  // Rate limited - result.retryAfter has seconds to wait
}
```

### 8. Distributed Lock
```typescript
const locks = createLockService(cache.adapter);

await locks.withLock("job:123", async () => {
  // Only one process executes this at a time
  await processJob();
});
```

### 9. Batch Operations
```typescript
const results = await cache.pipeline([
  pipelineEntry(schema.operations.hashGetAll, { userId: "1" }),
  pipelineEntry(schema.operations.hashGetAll, { userId: "2" }),
]);
```

## TTL Constants

```typescript
TTL.ONE_MINUTE       // 60
TTL.FIVE_MINUTES     // 300
TTL.ONE_HOUR         // 3600
TTL.ONE_DAY          // 86400
TTL.ONE_WEEK         // 604800
```

## Two-Layer Architecture

```typescript
// Layer 1: Cachyer - auto key prefix, metrics
await cache.get("key");  // Actual key: "myapp:key"

// Layer 2: Adapter - direct access, no prefix
await cache.adapter.xadd("stream", "*", fields);  // Streams
await cache.adapter.bfAdd("bloom", "item");       // Bloom filter
```

## Common Use Cases

| Use Case | Approach |
|----------|----------|
| User sessions | Hash schema with TTL |
| Leaderboards | Sorted set schema |
| API rate limits | RateLimitService |
| Job deduplication | Lock service |
| Feed/timeline | Sorted set by timestamp |
| Counters | Counter schema |
| Cache-aside | get → miss → fetch → set |

## Testing

```typescript
// Swap Redis for Memory in tests - same API
const cache = createMemoryCachyer({ keyPrefix: "test" });
```

## Links

- GitHub: https://github.com/[repo]/cachyer
- Docs: See /docs folder for detailed guides
- Examples: See /examples folder for real-world patterns
